---
title: "M1 macOS x Docker ã§ Flutter ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã‚ˆã†"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker", "flutter"]
published: true
---

## ã¯ã˜ã‚ã«
2021å¹´4æœˆ15æ—¥ã€Apple Silicon ã«æ­£å¼å¯¾å¿œã—ãŸ Docker for Mac ãŒä¸€èˆ¬å…¬é–‹ã•ã‚Œã€Apple Silicon ãª macOS ã§ã‚‚ Docker ã«ã‚ˆã‚‹ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ Docker for Mac ã‚’åˆ©ç”¨ã—ã¦ M1 macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Flutter ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥ä½œæˆã—ãŸ [ã“ã¡ã‚‰](https://zenn.dev/nagakuta/scraps/39449e6c92b8f3) ã®ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã‚’è¨˜äº‹ã¨ã—ã¦æ¸…æ›¸ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
:::

## ç’°å¢ƒ (2022/07/18 æ™‚ç‚¹)
- Macbook Air (M1, 2020)
- macOS: Monterey (`12.4`)
- Docker for Mac: `4.10.1 (82475)`
- Visual Studio Code: `1.69.1`
  - Remote - Containers: `v0.241.3`

## Docker for Mac ã®å°å…¥
ã¯ã˜ã‚ã«ã€`Docker for Mac` ã‚’ macOS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€**dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹** æ–¹æ³•ã¨ **`Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹** æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
2021/05/23 å½“æ™‚ã¯ `Docker for Mac` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã« `Rosetta2` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€2024 å¹´æ™‚ç‚¹ã§ã¯ `Rosetta2` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã‚‚ã— `Rosetta2` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® `Docker for Mac` ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ã€äº‹å‰ã« `$ softwareupdate --install-rosetta` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€`Rosetta2` ã‚’ macOS å†…ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
:::

### dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
1. [ã“ã¡ã‚‰](https://desktop.docker.com/mac/stable/arm64/Docker.dmg?utm_source=docker&utm_medium=webreferral&utm_campaign=docs-driven-download-mac-arm64) ã‹ã‚‰ dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
2. dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ãƒ‰ãƒ©ã‚¤ãƒå†…ã® `Docker for Mac` ã‚¢ãƒ—ãƒªã‚’ `/Applications` ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹

### `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
`Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€

1. (`Homebrew` ã‚’å°å…¥ã—ã¦ã„ãªã„å ´åˆ) `Homebrew` ã‚’å°å…¥
2. `Homebrew-cask` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ `Docker for Mac` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã®æ‰‹é †ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

#### 1. `Homebrew` ã®å°å…¥
[ã“ã¡ã‚‰](https://brew.sh/) ã‚’å‚è€ƒã«ã€`Homebrew` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
$ export PATH=/opt/homebrew/bin:$PATH
```

#### 2. Docker for Mac ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«ã€å…ˆç¨‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `Homebrew` ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ `Docker for Mac` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ brew install --cask docker
```

ã“ã‚Œã§ `Docker for Mac` ãŒ `/Applications` ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

## ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
æ¬¡ã«ã€Docker ã§ã®ä»®æƒ³ç’°å¢ƒã¨ãªã‚‹ Container ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’è¨­å®šã—ã¾ã™ã€‚

### `Dockerfile` ã®ä½œæˆ
ã¾ãšã¯ã€`Dockerfile` ã‚’ä½œæˆã—ã¦ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```Dockerfile:.devcontainer/flutter/Dockerfile
# (1): Base image
FROM dart:latest

# Maintainer
LABEL maintainer="XXX <xxx@example.com>"

# Workdir
WORKDIR /workspace/xxx

# (2): Install Flutter
ARG PATH=/root/.pub-cache/bin:$PATH
ARG FLUTTER_VERSION=x.y.z
RUN dart pub global activate melos --verbose && \
    dart pub global activate fvm --verbose && \
    fvm doctor --verbose && \
    fvm install $FLUTTER_VERSION --verbose && \
    fvm use --force $FLUTTER_VERSION --verbose && \
    # fvm flutter config --enable-web --enable-linux-desktop --enable-macos-desktop --enable-windows-desktop --enable-android --enable-ios --enable-fuchsia && \
    # fvm flutter precache --verbose && \
    fvm flutter doctor --verbose

# Set paths
ARG FVM_ROOT=/root/.pub-cache
ENV PATH $FVM_ROOT/bin:$PATH
```

#### (1): ãƒ™ãƒ¼ã‚¹ã¨ã™ã‚‹ Docker Image
ä»Šå›ã¯æœ€æ–°ç‰ˆã® Dart ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã—ã¦ã„ã¾ã™ãŒã€ç’°å¢ƒã®å¿…è¦ã«å¿œã˜ã¦ `dart:3.0-sdk` ã®ã‚ˆã†ã«ã€Dart ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

#### (2): Flutter ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»Šå›ã¯ [`Flutter Version Manager (FVM)`](https://fvm.app/) ã‚’åˆ©ç”¨ã—ã¦ Flutter ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

:::details Dart image ãŒåˆ©ç”¨ã§ããªã„å ´åˆ
```Dockerfile:.devcontainer/flutter/Dockerfile
# (1): Base image
FROM ubuntu:20.04

# Maintainer
LABEL maintainer="XXX <xxx@example.com>"

# Workdir
WORKDIR /workspace

# (2): Install Dart
ARG DART_VERSION=x.y.z
RUN mkdir -p /usr/share/man/man1 && \
    apt-get update && apt-get install -y --no-install-recommends tzdata && \
    apt-get update && \
    apt-get install -y --no-install-recommends bash ca-certificates clang cmake curl file git libglu1-mesa libgtk-3-dev ninja-build pkg-config unzip xz-utils zip && \
    curl https://storage.googleapis.com/dart-archive/channels/stable/release/$DART_VERSION/sdk/dartsdk-linux-x64-release.zip -o /tmp/dart-sdk.zip && \
    unzip /tmp/dart-sdk.zip -d /usr/lib && rm /tmp/dart-sdk.zip

# (3): Install Flutter
ARG PATH=/usr/lib/dart-sdk/bin:$PATH
ARG PATH=/root/.pub-cache/bin:$PATH
ARG FLUTTER_VERSION=x.y.z
RUN dart pub global activate fvm --verbose && \
    fvm doctor --verbose && \
    fvm install $FLUTTER_VERSION --verbose && \
    fvm use --force $FLUTTER_VERSION --verbose && \
    # fvm flutter config --enable-web --enable-linux-desktop --enable-macos-desktop --enable-windows-desktop --enable-android --enable-ios --enable-fuchsia && \
    # fvm flutter precache --verbose && \
    fvm flutter doctor --verbose

# Clean up
RUN apt-get clean -y && \
    apt-get autoremove -y && \
    rm -rf /var/lib/apt/lists/*

# Set paths
ARG FVM_ROOT=/root/.pub-cache
ENV PATH $FVM_ROOT/bin:$PATH
```

#### (1): ãƒ™ãƒ¼ã‚¹ã¨ã™ã‚‹ Image
ä»Šå›ã¯ `ubuntu:20.04` ã‚’ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦é¸æŠã—ã¾ã—ãŸã€‚

#### (2): Dart ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
`Dart` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ã«ã€`apt-get` ã‚’åˆ©ç”¨ã—ã¦ [`Flutter` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«](https://flutter.dev/docs/get-started/install/linux#system-requirements)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ãã®å¾Œã€`https://storage.googleapis.com/dart-archive/channels/be/raw/latest/sdk/dartsdk-<platform>-<architecture>-release.zip` ã‹ã‚‰ `Dart` SDK ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€è§£å‡ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

#### (3): Flutter ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»Šå›ã¯ [`Flutter Version Manager (FVM)`](https://fvm.app/) ã‚’åˆ©ç”¨ã—ã¦ Flutter ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
:::

### `docker-compose.yml` ã®ä½œæˆ
æ¬¡ã«ã€`docker-compose.yml` ã‚’ä½œæˆã—ã¦ Container ã‚’ build ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ Volume ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```yml:.devcontainer/docker-compose.yml
version: '3.8'
services:
  <project_name>:
    # (1): ä»®æƒ³ç’°å¢ƒã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ Dockerfile ã‚’æŒ‡å®š
    build:
      context: .
      dockerfile: flutter/Dockerfile
    # (2): Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
    volumes:
      - ../${YOUR_PROJECT_DIRECTORY}:/workspace/${YOUR_PROJECT_DIRECTORY}:cached
      # (Optional) VSCode settings
      - ../.vscode:/workspace/.vscode:cached
    command: /bin/sh -c "while sleep 1000; do :; done"
    # (3): ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
    env_file:
      - flutter/.flutter.env
```

#### (1): ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ Dockerfile ã‚’æŒ‡å®š
ä»®æƒ³ç’°å¢ƒã§ã‚ã‚‹ Container ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†éš›ã«ã€å…ˆã»ã©ä½œæˆã—ãŸ `.devcontainer/flutter/Dockerfile` ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

#### (2): Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

VSCode ã§é–‹ç™ºã‚’è¡Œã†å ´åˆã¯ã€Workspace ã®è¨­å®šã‚’ Remote Container å†…ã§é–‹ã„ãŸ VSCode ã«ã‚‚é©ç”¨ã™ã‚‹ãŸã‚ã«ã€`.vscode` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `/workspace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

#### (3): ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
`.devcontainer/flutter/.flutter.env` ã«ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã—ã€Container ã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

## ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®ç”Ÿæˆ
å…ˆã»ã©ä½œæˆã—ãŸ `Dockerfile` ã¨ `docker-compose.yml` ã‚’ã‚‚ã¨ã« Container ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€ãã®ä¸­ã¸æ¥ç¶šã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€**`docker` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹** æ–¹æ³•ã¨ã€**VSCode ã® `Remote - Containers` æ‹¡å¼µã‚’ä½¿ç”¨ã™ã‚‹** æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### `docker` ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
`docker` ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ“ãƒ«ãƒ‰ã¨ä»®æƒ³ç’°å¢ƒã¸ã®æ¥ç¶šã‚’è¡Œã„ã¾ã™ã€‚
```
$ docker compose build
$ docker compose up -d
$ docker exec -it <container_id> /bin/bash
```

### VSCode ã® `Remote - Containers` ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
1. VSCode ã«ã¦ `Remote - Containers` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
2. `Remote - Containers` ã® `Reopen in Container` > `From docker-compose.yml` ã‚’ã‚¯ãƒªãƒƒã‚¯

ã“ã‚Œã«ã¦ã€Flutter ã®é–‹ç™ºç’°å¢ƒã‚’ Container ã¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## Flutter ã®ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ Container å†…ã« Flutter Project ã‚’ä½œæˆ
Container ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ããŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦ Flutter Project ã‚’ä½œæˆã—ã¾ã™ã€‚

```
$ fvm flutter create <project_name> --org <your_organization>
```

ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€`/workspace/<project_name>` é…ä¸‹ã« Flutter Project ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

## ã¾ã¨ã‚
ã“ã®è¨˜äº‹ã§ã¯ã€Apple Silicon ãª macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Flutter Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

çš†ã•ã‚“ã‚‚ã€Docker Container ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’è¡Œã„ã€å†åˆ©ç”¨æ€§ã®é«˜ã„é–‹ç™ºç’°å¢ƒã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼

æœ¬è¨˜äº‹ã®ç–‘å•ç‚¹ã‚„æ„Ÿæƒ³ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã—ã¦ã„ã£ã¦ãã ã•ã„ï¼
