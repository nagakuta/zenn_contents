---
title: "M1 macOS x Docker ã§ Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã‚ˆã†"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Docker", "Firebase", "M1"]
published: true
---

# ã¯ã˜ã‚ã«
2021å¹´4æœˆ15æ—¥ã€Apple Silicon ã«æ­£å¼å¯¾å¿œã—ãŸ Docker for Mac ãŒä¸€èˆ¬å…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€Apple Silicon ãª macOS ã§ã‚‚ Docker ã«ã‚ˆã‚‹ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ Docker for Mac ã‚’åˆ©ç”¨ã—ã¦ M1 macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥ä½œæˆã—ãŸ [ã“ã¡ã‚‰](https://zenn.dev/nagakuta/scraps/89bd7538767f02) ã®ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã‚’è¨˜äº‹ã¨ã—ã¦æ¸…æ›¸ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
:::

# ç›®æ¬¡
```
- Docker for Mac ã®å°å…¥
- ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
- ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®ç”Ÿæˆ
- Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Container å†…ã« Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ä½œæˆ
- å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹
```

# ç’°å¢ƒ
- Macbook Air (M1, 2020)
- macOS: Big Sur (11.3.1)
- Docker for Mac: 3.3.3
- Visual Studio Code: 1.56.2
    - Remote - Containers: v0.177.2

# Docker for Mac ã®å°å…¥
ã¾ãšã€Docker for Mac ã‚’ macOS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€`dmg` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•ã¨ `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
2021/05/23 ç¾åœ¨ã€Docker for Mac ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ Rosetta2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
äº‹å‰ã« `softwareupdate --install-rosetta` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã€Rosetta2 ã‚’ macOS å†…ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚
:::

## `dmg` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
1. [ã“ã¡ã‚‰](https://desktop.docker.com/mac/stable/arm64/Docker.dmg?utm_source=docker&utm_medium=webreferral&utm_campaign=docs-driven-download-mac-arm64) ã‹ã‚‰ `dmg` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
2. `dmg` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ãƒ‰ãƒ©ã‚¤ãƒå†…ã® Docker for Mac ã‚¢ãƒ—ãƒªã‚’ `/Applications` ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹

## `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
Homebrew ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€

1. (`Homebrew` ã‚’å°å…¥ã—ã¦ã„ãªã„å ´åˆ) `Homebrew` ã‚’å°å…¥
2. `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ Docker for Mac ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã®æ‰‹é †ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

### `Homebrew` ã®å°å…¥
[ã“ã¡ã‚‰](https://brew.sh/) ã‚’å‚è€ƒã«ã€`Homebrew` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
$ export PATH=/opt/homebrew/bin:$PATH
```

### Docker for Mac ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
å…ˆç¨‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ Docker for Mac ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ brew install --cask docker
```

ã“ã‚Œã§ Docker for Mac ãŒ `/Applications` ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

# ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
æ¬¡ã«ã€Container ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’è¨­å®šã—ã¾ã™ã€‚

## `Dockerfile` ã®ä½œæˆ
ã¾ãšã¯ã€`Dockerfile` ã‚’ä½œæˆã—ã¦ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```Dockerfile:.devcontainer/firebase/Dockerfile
# Base image
FROM node:12.22.1-buster-slim

# Maintainer
LABEL maintainer="nagakuta <xxx@example.com>"

# Workdir
WORKDIR /workspace

# Install Firebase CLI
RUN npm config set registry http://registry.npmjs.org && \
    npm install --production -g firebase-tools --verbose
```

ä»Šå›ã®ãƒ™ãƒ¼ã‚¹ç’°å¢ƒã¯ `node:12.22.1-buster-slim` ã‚’é¸æŠã—ã¾ã—ãŸã€‚  
ãªãœè»½é‡ image ã¨ã—ã¦æœ‰åãª `Alpine` ã‚’åˆ©ç”¨ã—ãªã‹ã£ãŸã‹ã¨ã„ã†ã¨ã€é–‹ç™ºæ™‚ã®ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ VSCode ã®æ‹¡å¼µæ©Ÿèƒ½ã§ã‚ã‚‹ `Remote - Containers` ãŒ 2021/05/16 æ™‚ç‚¹ã§ `Alpine` ã«å¯¾å¿œã—ã¦ã„ãªã„ï¼ˆ[å‚è€ƒ](https://github.com/microsoft/vscode-remote-release/issues/4462)ï¼‰ãŸã‚ã§ã™ã€‚

## `docker-compose.yml` ã®ä½œæˆ
æ¬¡ã«ã€`docker-compose.yml` ã‚’ä½œæˆã—ã¦ Container ã‚’ build ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ Volume ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```yml:.devcontainer/docker-compose.yml
version: '3.8'
services:
    build:
      context: .
      dockerfile: firebase/Dockerfile
    volumes:
      # VSCode settings
      - ../.vscode:/workspace/.vscode:cached
    command: /bin/sh -c "while sleep 1000; do :; done"
    env_file:
      - firebase/.firebase.env
```

ä»Šå›ã¯

- `docker compse build` æ™‚ã« `.devcontainer/firebase/Dockerfile` ã‚’å‚ç…§
- VSCode ã® Workspace è¨­å®šã‚’ Container å†…ã§é–‹ã„ãŸ VSCode ã«ã‚‚é©ç”¨ã™ã‚‹ãŸã‚ã«ã€`.vscode` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `/workspace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆ
- ç§˜å¯†éµç­‰ã¯ `.devcontainer/firebase/.firebase.env` ã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å®šç¾©ã€`docker compose build` æ™‚ã« Container å´ã¸å±•é–‹

ã¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®ç”Ÿæˆ
å…ˆç¨‹ä½œæˆã—ãŸ `Dockerfile` ã¨ `docker-compose.yml` ã‚’ã‚‚ã¨ã« Container ã‚’ç”Ÿæˆã—ã€ãã® Container å†…ã¸æ¥ç¶šã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€`docker` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã¨ã€VSCode ã® `Remote - Containers` æ‹¡å¼µã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## `docker` ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
:::message
`docker` ã‚³ãƒãƒ³ãƒ‰ã¯ Docker for Mac ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã ã‘ã§ã¯ macOS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å‰ã«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ `docker` ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
:::

```
$ docker compose build
$ docker compose up -d
$ docker exec -it <Container ID> /bin/bash
```

## VSCode ã® `Remote - Containers` ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
1. VSCode ã«ã¦ `Remote - Containers` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
2. `Remote - Containers` ã® `Reopen in Container` > `From docker-compose.yml` ã‚’ã‚¯ãƒªãƒƒã‚¯

# Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Container å†…ã« Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ä½œæˆ
Container å†…ã¸æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ããŸã‚‰ã€æ¬¡ã¯ Container å†…ã§ Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ã€‚

ã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Firebase ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

```
$ firebase login:ci
```

ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ URL ã‚’é–‹ãã‚ˆã†æŒ‡ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã® URL ã‚’ PC ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚  
ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸæ™‚ã« Firebase ã‚’ CLI ã§å‹•ã‹ã™ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã‚‹ã®ã§ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ç’°å¢ƒå¤‰æ•°ï¼ˆ`FIREBASE_TOKEN=xxx`ï¼‰ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚  
ã“ã‚Œã§ã€Container ã‚’å†ãƒ“ãƒ«ãƒ‰ã—ã¦ç’°å¢ƒã‚’å†æ§‹ç¯‰ã™ã‚‹éš›ã« Firebase ã¸éƒ½åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚ Project ã«å¯¾ã—ã¦æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

æ¬¡ã«ã€Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆã“ã®æ“ä½œã‚’è¡Œã†å‰ã«ã€[Firebase Console](https://console.firebase.google.com/) ã«ã¦ Project ã‚’ä½œæˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®è¨˜äº‹ã«ãŠã„ã¦ã¯ä½œæˆæ–¹æ³•ã‚’çœç•¥ã—ã¾ã™ï¼‰ã€‚

Firebase Console ã«ã¦ Project ãŒä½œæˆã§ããŸã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€Container å†…ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã€ Project ã¨é€£æºã—ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```
$ firebase init
```

ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€

- ã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é€£æºã•ã›ã‚‹ã‹
- ã©ã® Firebase ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã‹ï¼ˆå¾Œã«è¨­å®šå¯ï¼‰
- æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆ`Firebase Local Emulator Suite`ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã‹ï¼ˆå¾Œã«è¨­å®šå¯ï¼‰

ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã«ã¦ã€Firebase ã®é–‹ç™ºç’°å¢ƒã‚’ Container å†…ã«ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

# å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹
ä»¥ä¸‹ã¯ã€ç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’é¸æŠã—ãŸéš›ã«è¿½åŠ ã§å¿…è¦ã¨ãªã‚‹è¨­å®šé …ç›®ã¨ãªã‚Šã¾ã™ã€‚

## `Firebase Local Emulator Suite` ã«ã¦ `Firestore` ã‚’å‹•ã‹ã™ãŸã‚ã®è¨­å®š
`firebase init` ã«ã¦ã€ã€Œ`Firestore` ã‚’åˆ©ç”¨ã™ã‚‹ã€ã‹ã¤ã€Œ`Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã™ã‚‹ã€ã“ã¨ã‚’é¸æŠã—ãŸå ´åˆã€ç¾åœ¨ã®é–‹ç™ºç’°å¢ƒã§ã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚  
ãªãœãªã‚‰ã€`Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ `Java` ã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€Container å†…ã« Java ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

ãªã®ã§ã€`Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’å‹•ã‹ã™ãŸã‚ã« Container ä½œæˆæ™‚ã« Java ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff Dockerfile:.devcontainer/firebase/Dockerfile
# Base image
FROM node:12.22.1-buster-slim

# Maintainer
LABEL maintainer="nagakuta <xxx@example.com>"

# Workdir
WORKDIR /workspace

+# Install Java JRE
+RUN mkdir -p /usr/share/man/man1 && \
+    apt-get update && \
+    apt-get install -y default-jre --no-install-recommends && \
+    apt-get clean -y && \
+    apt-get autoremove -y && \
+    rm -rf /var/lib/apt/lists/*

# Install Firebase CLI
RUN npm config set registry http://registry.npmjs.org && \
    npm install --production -g firebase-tools --verbose
```

ã“ã‚Œã«ã‚ˆã‚Šã€Container ã‚’ build ã—ãŸéš›ã« Java JRE ãŒ Container å†…ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€

```
$ firebase emulators:start --only firestore
```

ã®ã‚³ãƒãƒ³ãƒ‰ã§ `Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’å‹•ä½œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## `Cloud Functions for Firebase` ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã‚’æ•´ãˆã‚‹
`firebase init` ã«ã¦ `Cloud Functions for Firebase` ã®åˆ©ç”¨ã‚’é¸æŠã—ãŸéš›ã«ã€ã€ŒJavaScript ã¨ TypeScript ã®ã©ã¡ã‚‰ã§é–‹ç™ºã™ã‚‹ã‹ã€ã€ã€Œã‚³ãƒ¼ãƒ‰ã®é™çš„è§£æã‚’åˆ©ç”¨ã™ã‚‹ã‹ã€ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã“ã§ã¯ã€ã€ŒTypeScript ã§é–‹ç™ºã€ã‹ã¤ã€Œé™çš„è§£æã‚’åˆ©ç”¨ã™ã‚‹ã€ã‚’é¸æŠã—ãŸéš›ã«ã€

- `TypeScript` ã®è¨­å®š
- `ESLint` ã®è¨­å®š
- `Prettier` ã®å°å…¥

ã‚’è¡Œã†å ´åˆã®è¨­å®šä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### `TypeScript` ã®è¨­å®š
ã“ã“ã§ã¯ã€`TypeScript` ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã¡ã‚‰ã¯ `firebase init` æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ `tsconfig.json` ã‚’ä¸€éƒ¨ä¿®æ­£ã—ã¾ã—ãŸã€‚

```diff json:functions/tsconfig.json
{
  "compilerOptions": {
    "module": "commonjs",
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "outDir": "lib",
    "sourceMap": true,
    "strict": true,
    "target": "es2017",
+   "esModuleInterop": true,
  },
  "compileOnSave": true,
- "include": ["src"]
+ "include": ["src", "__tests__"]
}
```

ä»Šå›æ–°ãŸã«è¿½åŠ ã—ãŸã®ã¯ã€Jest ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹éš›ã«å¿…è¦ãªè¨­å®šã§ã™ã€‚

### `ESLint` ã®è¨­å®š
ã“ã“ã§ã¯ã€`ESLint` ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã¡ã‚‰ã¯ã€è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ `.eslintrc.js` ã‚’ JSON ã«æ›¸ãæ›ãˆãŸã®ã¿ã§ã™ã€‚

```json:functions/.eslintrc.json
{
  "env": {
    "es6": true,
    "node": true,
    "jest/globals": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:import/errors",
    "plugin:import/warnings",
    "plugin:import/typescript",
    "google"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "project": ["tsconfig.json", "tsconfig.dev.json"],
    "sourceType": "module"
  },
  "ignorePatterns": [
    "/lib/**/*" // Ignore built files.
  ],
  "plugins": ["@typescript-eslint", "import", "jest"],
  "rules": {
    "import/no-unresolved": "off"
  }
}
```

### `Prettier` ã®å°å…¥
ã“ã“ã§ã¯ã€TypeScript ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ Formatter ã§ã‚ã‚‹ [Prettier](https://prettier.io/) ã‚’å°å…¥ã—ã¾ã™ã€‚

ã¾ãšã€Container å†…ã«æ¥ç¶šã—ã¦ `functions` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«ç§»å‹•ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```
$ npm install --save-dev prettier eslint-config-prettier
```

æ¬¡ã«ã€`ESLint` ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã« `Prettier` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff json:functions/.eslintrc.json
{
  ...
  "extends": [
    "eslint:recommended",
    "plugin:import/errors",
    "plugin:import/warnings",
    "plugin:import/typescript",
    "google",
+   "prettier",
+   "prettier/@typescript-eslint"
  ],
  ...
}
```

#### (Optional) VSCode ã§ `Prettier` ã‚’ä½¿ç”¨ã™ã‚‹
VSCode ã«ã¦ `Prettier` ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€VSCode ã« [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) æ‹¡å¼µã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€VSCode ã®è¨­å®šã« `Prettier` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff json:.vscode/settings.json
{
  ...
+ "editor.codeActionsOnSave": {
+   "source.fixAll.eslint": true
+ },
+ "javascript.format.enable": false,
+ "typescript.format.enable": false,
+ "json.format.enable": false,
+ "eslint.alwaysShowStatus": true,
+ "eslint.format.enable": true,
+ "eslint.debug": true,
+ "prettier.prettierPath": "/workspace/functions/node_modules/prettier",
+ "[typescript]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ },
+ "[json]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ },
+ "[jsonc]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ }
  ...
}
```

ã“ã‚Œã§ã€VSCode ã«ã¦ `Prettier` ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰æ•´å½¢ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

# ã¾ã¨ã‚
ã“ã®è¨˜äº‹ã§ã¯ã€Apple Silicon ãª macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ã¿ãªã•ã‚“ã‚‚ã€Docker Container ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’è¡Œã„ã€å†åˆ©ç”¨æ€§ã®é«˜ã„é–‹ç™ºç’°å¢ƒã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼
