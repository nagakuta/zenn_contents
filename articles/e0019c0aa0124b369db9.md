---
title: "M1 macOS x Docker ã§ Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã‚ˆã†"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Docker", "Firebase", "M1"]
published: true
---

## ã¯ã˜ã‚ã«
2021å¹´4æœˆ15æ—¥ã€Apple Silicon ã«æ­£å¼å¯¾å¿œã—ãŸ Docker for Mac ãŒä¸€èˆ¬å…¬é–‹ã•ã‚Œã€Apple Silicon ãª macOS ã§ã‚‚ Docker ã«ã‚ˆã‚‹ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ Docker for Mac ã‚’åˆ©ç”¨ã—ã¦ M1 macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥ä½œæˆã—ãŸ [ã“ã¡ã‚‰](https://zenn.dev/nagakuta/scraps/89bd7538767f02) ã®ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã‚’è¨˜äº‹ã¨ã—ã¦æ¸…æ›¸ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
:::

## ç›®æ¬¡
```
- Docker for Mac ã®å°å…¥
- ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
- ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®ç”Ÿæˆ
- Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Container å†…ã« Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ä½œæˆ
- å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹
```

## ç’°å¢ƒ (2022/07/18 æ™‚ç‚¹)
- Macbook Air (M1, 2020)
- macOS: Monterey (`12.4`)
- Docker for Mac: `4.10.1 (82475)`
- Visual Studio Code: `1.69.1`
  - Remote - Containers: `v0.241.3`

## Docker for Mac ã®å°å…¥
ã¯ã˜ã‚ã«ã€`Docker for Mac` ã‚’ macOS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€**dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹** æ–¹æ³•ã¨ **`Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹** æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
2021/05/23 å½“æ™‚ã¯ `Docker for Mac` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã« `Rosetta2` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€2024 å¹´æ™‚ç‚¹ã§ã¯ `Rosetta2` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã‚‚ã— `Rosetta2` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® `Docker for Mac` ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ã€äº‹å‰ã« `$ softwareupdate --install-rosetta` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€`Rosetta2` ã‚’ macOS å†…ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
:::

### dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
1. [ã“ã¡ã‚‰](https://desktop.docker.com/mac/stable/arm64/Docker.dmg?utm_source=docker&utm_medium=webreferral&utm_campaign=docs-driven-download-mac-arm64) ã‹ã‚‰ dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
2. dmg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ãƒ‰ãƒ©ã‚¤ãƒå†…ã® `Docker for Mac` ã‚¢ãƒ—ãƒªã‚’ `/Applications` ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹

### `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
`Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€

1. (`Homebrew` ã‚’å°å…¥ã—ã¦ã„ãªã„å ´åˆ) `Homebrew` ã‚’å°å…¥
2. `Homebrew-cask` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ `Docker for Mac` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã®æ‰‹é †ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

#### 1. `Homebrew` ã®å°å…¥
[ã“ã¡ã‚‰](https://brew.sh/) ã‚’å‚è€ƒã«ã€`Homebrew` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
$ export PATH=/opt/homebrew/bin:$PATH
```

#### 2. Docker for Mac ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
æ¬¡ã«ã€å…ˆç¨‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `Homebrew` ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ `Homebrew-cask` ã‚’åˆ©ç”¨ã—ã¦ `Docker for Mac` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ brew install --cask docker
```

ã“ã‚Œã§ `Docker for Mac` ãŒ `/Applications` ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

## ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
æ¬¡ã«ã€Docker ã§ã®ä»®æƒ³ç’°å¢ƒã¨ãªã‚‹ Container ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’è¨­å®šã—ã¾ã™ã€‚

### `Dockerfile` ã®ä½œæˆ
ã¾ãšã¯ã€`Dockerfile` ã‚’ä½œæˆã—ã¦ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```Dockerfile:.devcontainer/firebase/Dockerfile
# Base image
FROM node:current-buster-slim

# Maintainer
LABEL maintainer="xxx <xxx@example.com>"

# Workdir
WORKDIR /workspace

# Install Firebase CLI
RUN npm config set registry http://registry.npmjs.org && \
    npm install --production -g firebase-tools --verbose
```

:::message
ãªãœè»½é‡ãª Docker Image ã¨ã—ã¦æœ‰åãª `Alpine` ã‚’åˆ©ç”¨ã—ãªã‹ã£ãŸã‹ã¨ã„ã†ã¨ã€é–‹ç™ºæ™‚ã®ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ VSCode ã®æ‹¡å¼µæ©Ÿèƒ½ã§ã‚ã‚‹ `Remote - Containers` ãŒåŸ·ç­†æ™‚ç‚¹(2021/05/16)ã§ [`Alpine` ã«å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸ](https://github.com/microsoft/vscode-remote-release/issues/4462) ãŸã‚ã§ã™ã€‚
:::

## `docker-compose.yml` ã®ä½œæˆ
æ¬¡ã«ã€`docker-compose.yml` ã‚’ä½œæˆã—ã¦ Container ã‚’ build ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ Volume ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```yml:.devcontainer/docker-compose.yml
version: '3.8'
services:
  <project_name>:
    # (1): ä»®æƒ³ç’°å¢ƒã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ Dockerfile ã‚’æŒ‡å®š
    build:
      context: .
      dockerfile: flutter/Dockerfile
    # (2): Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
    volumes:
      - ../${YOUR_PROJECT_DIRECTORY}:/workspace/${YOUR_PROJECT_DIRECTORY}:cached
      # (Optional) VSCode settings
      - ../.vscode:/workspace/.vscode:cached
    command: /bin/sh -c "while sleep 1000; do :; done"
    # (3): ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
    env_file:
      - firebase/.firebase.env
```

#### (1): ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹ Dockerfile ã‚’æŒ‡å®š
ä»®æƒ³ç’°å¢ƒã§ã‚ã‚‹ Container ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†éš›ã«ã€å…ˆã»ã©ä½œæˆã—ãŸ `.devcontainer/firebase/Dockerfile` ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

#### (2): Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
Container ã¸ãƒã‚¦ãƒ³ãƒˆã—ãŸã„ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

VSCode ã§é–‹ç™ºã‚’è¡Œã†å ´åˆã¯ã€Workspace ã®è¨­å®šã‚’ Remote Container å†…ã§é–‹ã„ãŸ VSCode ã«ã‚‚é©ç”¨ã™ã‚‹ãŸã‚ã«ã€`.vscode` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `/workspace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

#### (3): ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
`.devcontainer/firebase/.firebase.env` ã«ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã—ã€Container ã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

## ä»®æƒ³ç’°å¢ƒï¼ˆContainerï¼‰ã®ç”Ÿæˆ
å…ˆã»ã©ä½œæˆã—ãŸ `Dockerfile` ã¨ `docker-compose.yml` ã‚’ã‚‚ã¨ã« Container ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€ãã®ä¸­ã¸æ¥ç¶šã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€**`docker` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹** æ–¹æ³•ã¨ã€**VSCode ã® `Remote - Containers` æ‹¡å¼µã‚’ä½¿ç”¨ã™ã‚‹** æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### `docker` ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
`docker` ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ“ãƒ«ãƒ‰ã¨ä»®æƒ³ç’°å¢ƒã¸ã®æ¥ç¶šã‚’è¡Œã„ã¾ã™ã€‚
```
$ docker compose build
$ docker compose up -d
$ docker exec -it <container_id> /bin/bash
```

### VSCode ã® `Remote - Containers` ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
1. VSCode ã«ã¦ `Remote - Containers` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
2. `Remote - Containers` ã® `Reopen in Container` > `From docker-compose.yml` ã‚’ã‚¯ãƒªãƒƒã‚¯

ã“ã‚Œã«ã¦ã€Firebase ã®é–‹ç™ºç’°å¢ƒã‚’ Container ã¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Container å†…ã« Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ä½œæˆ
Container ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ããŸã‚‰ã€æ¬¡ã¯ Firebase CLI ã‚’åˆ©ç”¨ã—ã¦ Firebase Project ã‚’ä½œæˆã—ã¾ã™ã€‚

### Firebase ã¸ãƒ­ã‚°ã‚¤ãƒ³
ã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ Firebase ã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

```
$ firebase login:ci
```

ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ URL ã‚’é–‹ãã‚ˆã†æŒ‡ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸæ™‚ã« Firebase ã‚’ CLI ã§å‹•ã‹ã™ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã‚‹ã®ã§ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ç’°å¢ƒå¤‰æ•°ï¼ˆ`FIREBASE_TOKEN=xxx`ï¼‰ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚

ã“ã‚Œã§ã€Container ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ç’°å¢ƒã‚’å†æ§‹ç¯‰ã™ã‚‹éš›ã« Firebase ã¸éƒ½åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ãªãã¦ã‚‚ Project ã«å¯¾ã—ã¦æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆ
æ¬¡ã«ã€Firebase Project ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

:::message
ã“ã®æ“ä½œã‚’è¡Œã†å‰ã«ã€[Firebase Console](https://console.firebase.google.com/) ã§ Project ã‚’ä½œæˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯çœç•¥ã—ã¾ã™ã€‚
:::

Firebase Console ã«ã¦ Project ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‚’ç¢ºèªã—ãŸã‚‰ã€Container å†…ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã€Project ã¨é€£æºã—ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```
$ firebase init
```

ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€

- ã©ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é€£æºã•ã›ã‚‹ã‹
- ã©ã® Firebase ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã‹ï¼ˆå¾Œã«è¨­å®šå¯ï¼‰
- æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆ`Firebase Local Emulator Suite`ï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã‹ï¼ˆå¾Œã«è¨­å®šå¯ï¼‰

ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## (Optional) å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹
ä»¥ä¸‹ã¯ã€ç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’é¸æŠã—ãŸéš›ã«è¿½åŠ ã§å¿…è¦ã¨ãªã‚‹è¨­å®šé …ç›®ã¨ãªã‚Šã¾ã™ã€‚

### `Firebase Local Emulator Suite` ã«ã¦ `Firestore` ã‚’å‹•ã‹ã™ãŸã‚ã®è¨­å®š
`firebase init` ã«ã¦ã€**`Firestore` ã‚’åˆ©ç”¨ã™ã‚‹** ã‹ã¤ **`Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã™ã‚‹** ã“ã¨ã‚’é¸æŠã—ãŸå ´åˆã€ä¸Šè¨˜ã§æ§‹ç¯‰ã—ãŸä»®æƒ³ç’°å¢ƒã§ã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãªãœãªã‚‰ã€`Firestore` ã¯ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã« `Java` ã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã™ãŒã€æ§‹ç¯‰ã—ãŸä»®æƒ³ç’°å¢ƒå†…ã«ã¯ `Java` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

ãªã®ã§ã€`Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’å‹•ã‹ã™ãŸã‚ã«ã€ä»®æƒ³ç’°å¢ƒå†…ã« `Java` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```diff Dockerfile:.devcontainer/firebase/Dockerfile
# Base image
FROM node:current-buster-slim

# Maintainer
LABEL maintainer="nagakuta <xxx@example.com>"

# Workdir
WORKDIR /workspace

+# Install Java JRE
+RUN mkdir -p /usr/share/man/man1 && \
+    apt-get update && \
+    apt-get install -y default-jre --no-install-recommends && \
+    apt-get clean -y && \
+    apt-get autoremove -y && \
+    rm -rf /var/lib/apt/lists/*

# Install Firebase CLI
RUN npm config set registry http://registry.npmjs.org && \
    npm install --production -g firebase-tools --verbose
```

ã“ã‚Œã«ã‚ˆã‚Šã€Container ã‚’ãƒ“ãƒ«ãƒ‰ã—ãŸéš›ã« `Java JRE` ãŒä»®æƒ³ç’°å¢ƒå†…ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€

```
$ firebase emulators:start --only firestore
```

ã®ã‚³ãƒãƒ³ãƒ‰ã§ `Firestore` ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’èµ·å‹•ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### `Cloud Functions for Firebase` ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç’°å¢ƒã‚’æ•´ãˆã‚‹
`firebase init` ã«ã¦ `Cloud Functions for Firebase` ã®åˆ©ç”¨ã‚’é¸æŠã—ãŸéš›ã«ã€**JavaScript ã¨ TypeScript ã®ã©ã¡ã‚‰ã§é–‹ç™ºã™ã‚‹ã‹**ã€**ã‚³ãƒ¼ãƒ‰ã®é™çš„è§£æã‚’åˆ©ç”¨ã™ã‚‹ã‹** ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã“ã§ã¯ã€**`TypeScript` ã§é–‹ç™º** ã‹ã¤ **é™çš„è§£æã‚’åˆ©ç”¨ã™ã‚‹** ã‚’é¸æŠã—ãŸéš›ã«ã€

- `TypeScript` ã®è¨­å®š
- `ESLint` ã®è¨­å®š
- `Prettier` ã®å°å…¥

ã‚’è¡Œã†å ´åˆã®è¨­å®šä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

#### `TypeScript` ã®è¨­å®š
ã¾ãšåˆã‚ã« `TypeScript` ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ä»Šå›ã¯ã€`firebase init` æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ `tsconfig.json` ã®ä¸€éƒ¨ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

ä»Šå›æ–°ãŸã«è¿½åŠ ã—ãŸã®ã¯ã€`JavaScript` ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ `Jest` ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹éš›ã«å¿…è¦ãªè¨­å®šã§ã™ã€‚

```diff json:functions/tsconfig.json
{
  "compilerOptions": {
    "module": "commonjs",
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "outDir": "lib",
    "sourceMap": true,
    "strict": true,
    "target": "es2017",
+   "esModuleInterop": true,
  },
  "compileOnSave": true,
- "include": ["src"]
+ "include": ["src", "__tests__"]
}
```

#### `ESLint` ã®è¨­å®š
æ¬¡ã« `ESLint` ã«é–¢ã™ã‚‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚å…ˆã»ã©ã¨åŒã˜ãã€`firebase init` æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸ `.eslintrc.js` ã‚’ JSON å½¢å¼ã«æ›¸ãæ›ãˆãŸã®ã¿ã§ã™ã€‚

```json:functions/.eslintrc.json
{
  "env": {
    "es6": true,
    "node": true,
    "jest/globals": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:import/errors",
    "plugin:import/warnings",
    "plugin:import/typescript",
    "google"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "project": ["tsconfig.json", "tsconfig.dev.json"],
    "sourceType": "module"
  },
  "ignorePatterns": [
    "/lib/**/*" // Ignore built files.
  ],
  "plugins": ["@typescript-eslint", "import", "jest"],
  "rules": {
    "import/no-unresolved": "off"
  }
}
```

#### `Prettier` ã®å°å…¥
æœ€å¾Œã«ã€`TypeScript` ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ Formatter ã§ã‚ã‚‹ [Prettier](https://prettier.io/) ã‚’å°å…¥ã—ã¾ã™ã€‚

ã¾ãšã€Container ã«æ¥ç¶šã—ã¦ `functions` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«ç§»å‹•ã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```
$ npm install --save-dev prettier eslint-config-prettier
```

æ¬¡ã«ã€`ESLint` ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹ `.eslintrc.json` ã« `Prettier` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff json:functions/.eslintrc.json
{
  ...
  "extends": [
    "eslint:recommended",
    "plugin:import/errors",
    "plugin:import/warnings",
    "plugin:import/typescript",
    "google",
+   "prettier",
+   "prettier/@typescript-eslint"
  ],
  ...
}
```

##### (Optional) VSCode ã§ `Prettier` ã‚’ä½¿ç”¨ã™ã‚‹
VSCode ã«ã¦ `Prettier` ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€VSCode ã« [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) æ‹¡å¼µã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€VSCode ã®è¨­å®šã« `Prettier` ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff json:.vscode/settings.json
{
  ...
+ "editor.codeActionsOnSave": {
+   "source.fixAll.eslint": true
+ },
+ "javascript.format.enable": false,
+ "typescript.format.enable": false,
+ "json.format.enable": false,
+ "eslint.alwaysShowStatus": true,
+ "eslint.format.enable": true,
+ "eslint.debug": true,
+ "prettier.prettierPath": "/workspace/functions/node_modules/prettier",
+ "[typescript]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ },
+ "[json]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ },
+ "[jsonc]": {
+   "editor.defaultFormatter": "esbenp.prettier-vscode"
+ }
  ...
}
```

ã“ã‚Œã§ã€VSCode ã«ã¦ `Prettier` ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰æ•´å½¢ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## ã¾ã¨ã‚
ã“ã®è¨˜äº‹ã§ã¯ã€Apple Silicon ãª macOS ä¸Šã« Docker Container ã‚’ç«‹ã¦ã€Firebase Project ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

çš†ã•ã‚“ã‚‚ã€Docker Container ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã‚„å…±æœ‰ã‚’è¡Œã„ã€å†åˆ©ç”¨æ€§ã®é«˜ã„é–‹ç™ºç’°å¢ƒã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼

æœ¬è¨˜äº‹ã®ç–‘å•ç‚¹ã‚„æ„Ÿæƒ³ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã—ã¦ã„ã£ã¦ãã ã•ã„ï¼
